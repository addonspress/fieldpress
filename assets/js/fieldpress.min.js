!function(w,u,y,e){"use strict";var p=w(y),t=w("body"),i=w(u);"function"==typeof Color&&(Color.fn.toString=function(){if(this._alpha<1)return this.toCSS("rgba",this._alpha).replace(/\s+/g,"");var e=parseInt(this._color,10).toString(16);if(this.error)return"";if(e.length<6)for(var t=6-e.length-1;0<=t;t--)e="0"+e;return"#"+e});var f=function(e){var t=e.replace(/\s+/g,""),i=-1!==t.indexOf("rgba")?parseFloat(100*t.replace(/^.*,(.+)\)/,"$1")):100;return{value:t,alpha:i,rgba:i<100}};if("undefined"!=typeof google&&google&&google.maps)var a=function(){p.on("click",".fieldpress-show-map",function(e){e.preventDefault();var i,t=w(this),a=t.closest(".fieldpress-field.fieldpress-map"),s=a.find(".fieldpress-map-wrapper"),r=a.find(".fieldpress-map-holder"),l=r.data("lat"),n=r.data("long"),d=a.find(".fieldpress-address"),o=a.find(".fieldpress-search-map"),p=a.find(".fieldpress-find-map"),f=a.find(".fieldpress-map-lat-long"),c=parseInt(f.attr("zoom"));s.slideDown();var u=function(e){var t=new google.maps.Geocoder;setTimeout(function(){t.geocode({latLng:e},function(e){e&&0<e.length&&h(e[0].formatted_address)})},2e3)},h=function(e){d.show().text(e)},v=new google.maps.LatLng(l,n),g={zoom:c,center:v,mapTypeId:google.maps.MapTypeId.ROADMAP},m=new google.maps.Map(y.getElementById(r.attr("id")),g),b=new google.maps.Geocoder;i=new google.maps.Marker({map:m,draggable:!0,position:v}),google.maps.event.addListener(i,"dragend",function(e){var t=i.getPosition();m.panTo(t),u(t)}),google.maps.event.addListener(i,"drag",function(){b.geocode({latLng:i.getPosition()},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&(f.val(i.getPosition().lat()+","+i.getPosition().lng()),f.trigger("change"))})}),o.autocomplete({source:function(e,i){b.geocode({address:e.term},function(e,t){i(w.map(e,function(e){return{label:e.formatted_address,value:e.formatted_address}}))})}}),p.click(function(e){e.preventDefault();var t=o.val();b.geocode({address:t},function(e,t){t===google.maps.GeocoderStatus.OK?(m.setCenter(e[0].geometry.location),i.setPosition(e[0].geometry.location),f.val(i.getPosition().lat()+","+i.getPosition().lng()),u(i.getPosition()),m.setZoom(14)):alert("Geocode was not successful for the following reason: "+t)}),e.preventDefault()}),t.hide()}),p.on("click",".fieldpress-map-clear",function(e){e.preventDefault();var t=w(this).closest(".fieldpress-field.fieldpress-map"),i=t.find(".fieldpress-map-wrapper"),a=t.find(".fieldpress-map-holder"),s=t.find(".fieldpress-show-map");i.slideUp(),a.html(""),s.show()})};var s=function(e){var t=w("input:invalid").first().closest(".fieldpress-tabs-content-wrapper"),i=t.attr("id"),a=w(".fieldpress-main-tabs");if(!t.hasClass("hidden"))return!0;t.siblings(".fieldpress-tabs-content-wrapper").addClass("hidden"),t.removeClass("hidden"),a.find("li").each(function(){var e=w(this),t=e.children("a").attr("href").replace("#","");i===t&&(e.siblings("li").removeClass("active"),e.addClass("active"))})};p.on("click",".fieldpress-open-wysiwyg",function(e){e.preventDefault();var t=w(this).closest(".fieldpress-field.fieldpress-wysiwyg");r(t)});var r=function(e){var t=e,r=t.find(".fieldpress-open-wysiwyg"),l=t.find(".fieldpress-wysiwyg-textarea"),n=l.attr("id"),d=l.attr("mediaButtons"),o=l.attr("quicktags"),p=l.attr("plugins"),f=l.attr("toolbar1"),c=l.attr("block_formats");h(l)||function e(){var t,i,a,s=!1;if(y.getElementById(n)){if(tinymce.get(n)&&(s=tinymce.get(n).isHidden(),wp.editor.remove(n),tinymce.EditorManager.execCommand("mceRemoveEditor",!0,n)),wp.editor.initialize(n,{tinymce:{wpautop:!0,plugins:p,toolbar1:f,block_formats:c},mediaButtons:d,quicktags:o}),!(t=u.tinymce.get(n)))throw new Error("Failed to initialize editor");a=function(){w(t.getWin()).on("unload",function(){_.defer(e)}),s&&switchEditors.go(n,"toggle")},t.initialized?a():t.on("init",a),i=function(){t.isDirty()&&(wp.customize&&(wp.customize.state("processing").set(wp.customize.state("processing").get()+1),_.delay(function(){wp.customize.state("processing").set(wp.customize.state("processing").get()-1)},300)),t.save(),l.trigger("change"))},t.on("focus",function(){}),t.on("NodeChange",_.debounce(i,1e3)),t.on("blur",function(){i()}),r.hide()}}()},b=function(e){return e.attr("data-depth")},l=function(){var u,d,o,h,v,g,m,e=w(".fieldpress-repeater");e.sortable({placeholder:"fp-sortable-placeholder",items:"> .repeater-table",handle:"> .fieldpress-repeater-top > .fieldpress-repeater-title",cursor:"move",distance:2,containment:"#wpwrap",tolerance:"pointer",refreshPositions:!0,start:function(e,t){if(1===(u=t.item.closest(".fieldpress-repeater")).data("nested")){10<(v=u.attr("data-max-depth")?u.data("max-depth"):10)&&(v=10),d=t.item.children(".fs-repeater-transport"),o=b(t.item);var i,a,s,r=t.item.next()[0]==t.placeholder[0]?t.item.next():t.item,l=(i=r,a=o,s=w(),i.nextAll(".repeater-table").each(function(){var e=w(this);if(!(b(e)>a))return!1;s=s.add(e)}),s);d.append(l);var n=d.outerHeight();n+=0<n?1*t.placeholder.css("margin-top").slice(0,-2):0;n+=t.helper.outerHeight();n-=2,t.placeholder.height(n),t.placeholder.detach(),w(this).sortable("refresh"),t.item.after(t.placeholder)}},sort:function(e,t){if(1===u.data("nested")){var i,a,s=t.helper.offset().left,r=u.offset().left,l=(i=s-r,a=32,Math.floor(i/a)),n=t.placeholder.prev(".repeater-table");n.hasClass("ui-sortable-helper")&&(n=n.prev(".repeater-table"));var d=t.placeholder.next(".repeater-table");if(d.hasClass("ui-sortable-helper")&&(d=d.next(".repeater-table")),n.length){var o=[];h=l;var p=parseInt(b(n));if(d.length){var f=parseInt(b(d));p<f?o.push(p+1):(o.push(p),o.push(p+1),o.push(f))}else n.prevAll(".repeater-table").each(function(){var e=w(this),t=parseInt(b(e));if(0===t)return!1;o.push(t)}),o.push(0),o.push(p),o.push(p+1);g=Math.min.apply(Math,o),m=Math.max.apply(Math,o),v<m&&(m=v),h<g?h=g:m<h&&(h=m);var c=32*h;t.item.attr("data-depth",h),t.placeholder.css("margin-left",c)}else l=0,t.item.css("margin-left",0),t.placeholder.css("margin-left",0),h=0,t.item.attr("data-depth",h)}},update:function(e,t){t.item.find("[name]").each(function(){w(this).trigger("change")})},stop:function(e,t){if(1===u.data("nested")){var i,a=h-o;if(i=d.children().insertAfter(t.item),0!==a){var s=32*h;t.item.css("margin-left",s),i.each(function(){var e=w(this),t=parseInt(e.attr("data-depth"))+a;t<0?t=0:v<t&&(t=v);var i=32*t;e.css("margin-left",i),e.attr("data-depth",t)})}u.find(".repeater-table").each(function(e,t){var i=w(this),a=i.find(".fp-parent"),s=i.find(".fp-depth"),r=i.find(".fp-index"),l=parseInt(b(i));s.attr("data-index",e);var n=-1;i.prevAll(".repeater-table").each(function(){var e=w(this);if(parseInt(b(e))<l)return n=e.attr("data-index"),!1}),a.attr("value",n),s.attr("value",l),r.attr("value",e)}),u.find(".repeater-table").each(function(e,t){var i=w(this),a=i.find(".fp-parent"),s=i.find(".fp-depth"),r=i.find(".fp-index"),l=parseInt(b(i));i.attr("data-index",e);var n=-1;i.prevAll(".repeater-table").each(function(){var e=w(this);if(parseInt(b(e))<l)return n=e.attr("data-index"),!1}),a.attr("value",n),s.attr("value",l),r.attr("value",e)})}}})},o=function(e,t,i){var a=new RegExp(t,"g");return e.replace(a,i)},n=function(){var l;p.on("click",".fieldpress-image-uploader-open",function(e){e.preventDefault();var a,t=w(this),i=t.closest(".fieldpress-field.fieldpress-image"),s=i.find(".fieldpress-image-preview"),r=i.find("input"),l=i.find("img");"undefined"!=typeof wp&&wp.media&&wp.media.gallery&&(a||((a=wp.media({library:{type:"image"},title:t.data("upload"),button:{text:t.data("button-text")}})).on("open",function(){var e=r.val();if(e){var t=a.state().get("selection"),i=wp.media.attachment(e);t.add(i)}}),a.on("select",function(){var e=a.state().get("selection").first().toJSON(),t=void 0!==e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;s.removeClass("hidden"),l.attr("src",t),r.val(e.id),r.trigger("change")})),a.open())}),p.on("click",".fieldpress-clear",function(e){e.preventDefault();var t=w(this).closest(".fieldpress-field.fieldpress-image"),i=t.find(".fieldpress-image-preview");t.find("input").val(""),i.addClass("hidden")}),p.on("click",".fieldpress-gallery-uploader-open,.fieldpress-gallery-updater-open",function(e){e.preventDefault();var s,t=w(this),i=t.closest(".fieldpress-field.fieldpress-gallery"),r=i.find(".fieldpress-gallery-preview"),l=i.find(".fieldpress-gallery-uploader-open"),n=i.find(".fieldpress-gallery-updater-open"),d=i.find(".fieldpress-remove"),o=i.find("input"),a=t.hasClass("fieldpress-gallery-updater-open")?"gallery-edit":"gallery-library";"undefined"!=typeof wp&&wp.media&&wp.media.gallery&&((s=wp.media({library:{type:"image"},title:t.data("upload"),button:{text:t.data("button-text")},frame:"post",state:a,multiple:!0})).on("open",function(){var e=o.val();if(e){var t=e.split(","),i=s.state().get("library");t.forEach(function(e){var t=wp.media.attachment(e);t.fetch(),i.add(t?[t]:[])})}}),s.on("update",function(){var i="",a=[];s.state().get("library").each(function(e){var t=void 0!==(e=e.toJSON()).sizes.thumbnail?e.sizes.thumbnail.url:e.url;i+='<li><img src="'+t+'"></li>',a.push(e.id)}),o.val(a),r.html("").append(i),l.addClass("hidden"),r.removeClass("hidden"),n.removeClass("hidden"),d.removeClass("hidden"),o.trigger("change")}),s.open())}),p.on("click",".fieldpress-remove",function(e){e.preventDefault();var t=w(this),i=w(this).closest(".fieldpress-field.fieldpress-gallery"),a=i.find(".fieldpress-gallery-preview"),s=i.find(".fieldpress-gallery-updater-open"),r=i.find(".fieldpress-gallery-uploader-open");i.find("input").val(""),a.html(""),t.addClass("hidden"),s.addClass("hidden"),r.removeClass("hidden")}),p.on("click",".fieldpress-file-uploader-open",function(e){e.preventDefault();var o,t=w(this),i=t.closest(".fieldpress-field.fieldpress-file"),p=i.find(".fieldpress-file-preview-holder"),f=(i.find("img"),i.find(".fieldpress-file-title"),i.find(".fieldpress-file-name"),i.find(".fieldpress-file-size"),t.data("file-type")),c=t.data("button-text"),u=(t.data("title"),i.find("input")),h=u.data("multiple");h=""!==h,"undefined"!=typeof wp&&wp.media&&wp.media.gallery&&(o||((o=wp.media({library:{type:f},title:t.data("upload"),button:{text:t.data("button-text")},multiple:h})).on("open",function(){var e=u.val();if(e&&e){var t=e.split(","),i=o.state().get("selection");t.forEach(function(e){var t=wp.media.attachment(e);t.fetch(),i.add(t?[t]:[])})}}),o.on("select",function(){var n="";if(h){var d=[];o.state().get("selection").each(function(e){var t=(e=e.toJSON()).icon,i=e.title,a=e.filename,s=e.url,r=e.id,l=e.filesizeHumanReadable;n+='<div class="fieldpress-file-preview" data-value="'+r+'">',n+='<div class="fieldpress-file-wrap">',n+='<i class="dashicons dashicons-no fieldpress-file-clear"></i>',n+='<div class="fieldpress-icon-wrapper">',n+='<a data-file-type="'+f+'" data-button-text="'+c+'" data-title="'+i+'" href="#" class="fieldpress-file-uploader-open">',n+='<img src="'+t+'">',n+="</a>",n+="</div>",n+='<div class="fieldpress-file-details">',n+='<div class="fieldpress-file-title">'+i+"</div>",n+='<div class="fieldpress-file-name"><a class="fieldpress-file-link" href="'+s+'" target="_blank">'+a+"</a></div>",n+='<div class="fieldpress-file-size">'+l+"</div>",n+="</div>",n+="</div>",n+="</div>",d.push(e.id)}),p.removeClass("hidden"),p.html(n),u.val(d),u.trigger("change")}else{var e=o.state().get("selection").first().toJSON(),t=e.icon,i=e.title,a=e.filename,s=e.url,r=e.id,l=e.filesizeHumanReadable;n+='<div class="fieldpress-file-preview" data-value="'+r+'">',n+='<div class="fieldpress-file-wrap">',n+='<i class="dashicons dashicons-no fieldpress-file-clear"></i>',n+='<div class="fieldpress-icon-wrapper">',n+='<a data-file-type="'+f+'" data-button-text="'+c+'" data-title="'+i+'" href="#" class="fieldpress-file-uploader-open">',n+='<img src="'+t+'">',n+="</a>",n+="</div>",n+='<div class="fieldpress-file-details">',n+='<div class="fieldpress-file-title">'+i+"</div>",n+='<div class="fieldpress-file-name"><a class="fieldpress-file-link" href="'+s+'" target="_blank">'+a+"</a></div>",n+='<div class="fieldpress-file-size">'+l+"</div>",n+="</div>",n+="</div>",n+="</div>",p.removeClass("hidden"),p.html(n),u.val(r),u.trigger("change")}})),o.open())}),p.on("click",".fieldpress-file-clear",function(e){e.preventDefault();var t=w(this),i=t.closest(".fieldpress-field.fieldpress-file"),a=t.closest(".fieldpress-file-preview"),s=a.data("value"),r=i.find("input"),l=r.val().split(","),n=[];l.forEach(function(e){s!=e&&n.push(e)}),r.val(n),a.remove()}),l=!1,p.on("click",".fieldpress-icon-selector-open",function(e){e.preventDefault();var t=w(this),a=t.closest(".fieldpress-field.fieldpress-icon").find(".fieldpress-icon-preview"),s=t.next("input"),r=w("#fieldpress-icon-modal"),i=w("#fieldpress-select-icons-load");r.removeClass("hidden"),l||w.ajax({type:"POST",url:fieldpress.ajaxurl,data:{action:"fieldpress_select_icons"},success:function(e){i.html(e),l=!0,i.on("click",".single-icon",function(e){e.preventDefault();var t=w(this).children("i").attr("class"),i=t.split(" ")[1];r.addClass("hidden"),s.val(i),a.removeClass("hidden"),a.find("a").html('<i class="'+t+'"></i>')}),p.on("keyup","#fieldpress-icon-search",function(){var t=w(this).val();i.find("i").each(function(){var e=w(this);-1<e.attr("class").search(t)?e.parent(".single-icon").show():e.parent(".single-icon").hide()})})}})}),p.on("click",".fieldpress-icon-modal-close",function(e){w("#fieldpress-icon-modal").addClass("hidden")}),p.on("click",".fieldpress-icon-clear",function(e){e.preventDefault();var t=w(this).closest(".fieldpress-field.fieldpress-icon"),i=t.find(".fieldpress-icon-preview");t.find("input").val(""),i.addClass("hidden")}),p.on("click",".fields-tabs > li > a",function(e){e.preventDefault();var t=w(this),a=t.attr("href").replace("#",""),i=t.closest(".fieldpress-tabs");t.parent("li").siblings("li").removeClass("active"),t.parent("li").addClass("active"),i.find(".fields-tabs-content").each(function(e,t){var i=w(this);i.attr("id")===a?(i.removeClass("hidden"),r(i)):i.addClass("hidden")})}),p.on("click",".fieldpress-main-tabs > li > a",function(e){e.preventDefault();var t=w(this),a=t.attr("href").replace("#",""),i=t.closest(".fieldpress-wrap"),s=i.find(".fieldpress-current-section");t.parent("li").siblings("li").removeClass("active"),t.parent("li").addClass("active"),s.val(a),i.find(".fieldpress-tabs-content-wrapper").each(function(e,t){var i=w(this);i.attr("id")===a?(i.removeClass("hidden"),r(i)):i.addClass("hidden")})}),"undefined"!=typeof google&&google&&google.maps&&a(),p.on("click",".fieldpress-add-repeater",function(e){e.preventDefault();var t=w(this),i=t.closest(".fieldpress-repeater"),a=i.children(".fieldpress-code-for-repeater"),s=i.children(".fieldpress-total-repeater"),r=parseInt(s.val()),l=a.html();s.val(r+1);var n=o(l,t.attr("id"),r);n=o(n,"fieldpress-tab-id","tab-"+r),n=o(n,"fieldpress-filed-name","name"),t.before(w('<div class="repeater-table open" data-depth="0"></div>').append(n));var d=t.prev(".repeater-table");c(d)}),p.on("click",".fieldpress-repeater-top, .fieldpress-repeater-close",function(e){e.preventDefault();var t=w(this).closest(".repeater-table"),i=t.find(".fieldpress-repeater-inside:first");i.is(":hidden")?i.slideDown("fast",function(){t.addClass("open"),r(t)}):i.slideUp("fast",function(){t.removeClass("open")})}),p.on("click",".fieldpress-repeater-remove",function(e){e.preventDefault(),w(this).closest(".repeater-table").remove()}),"widgets"!==u.pagenow&&c(t)},h=function(e){return 0<e.closest(".fieldpress-code-for-repeater").length},c=function(e){e.find(".fieldpress-color-picker").each(function(){h(w(this))||function(d){if(d.data("rgba")&&1===d.data("rgba")){var o=f(d.val());d.wpColorPicker({clear:function(){d.trigger("keyup")},change:function(e,t){var i=t.color.toString();d.closest(".wp-picker-container").find(".fp-rgba-slider-offset").css("background-color",i),d.val(i).trigger("change")},create:function(){var a=d.data("a8cIris"),i=d.closest(".wp-picker-container"),s=w('<div class="fp-rgba-wrap"><div class="fp-rgba-slider"></div><div class="fp-rgba-slider-offset"></div><div class="fp-rgba-text"></div></div>').appendTo(i.find(".wp-picker-holder")),r=s.find(".fp-rgba-slider"),l=s.find(".fp-rgba-text"),n=s.find(".fp-rgba-slider-offset");r.slider({slide:function(e,t){var i=parseFloat(t.value/100);a._color._alpha=i,d.wpColorPicker("color",a._color.toString()),l.text(i<1?i:"")},create:function(){var e=parseFloat(o.alpha/100),t=e<1?e:"";l.text(t),n.css("background-color",o.value),i.on("click",".wp-picker-clear",function(){a._color._alpha=1,l.text("").trigger("change"),r.slider("option","value",100).trigger("slide")}),i.on("click",".wp-picker-default",function(){var e=f(d.data("default-color")),t=parseFloat(e.alpha/100),i=t<1?t:"";a._color._alpha=t,l.text(i),r.slider("option","value",e.alpha).trigger("slide")}),i.on("click",".wp-color-result",function(){s.toggle()}),p.on("click.wpcolorpicker",function(){s.hide()})},value:o.alpha,step:1,min:1,max:100})}})}else d.wpColorPicker({change:_.throttle(function(){d.trigger("change")},3e3),clear:_.throttle(function(){d.trigger("change")},4e3)})}(w(this))}),e.find(".fieldpress-date-picker").each(function(){var e;h(w(this))||((e=w(this)).data("fieldpress-time")&&e.data("time-only")?e.timepicker({timeFormat:e.data("time-format")}):e.data("fieldpress-time")?e.datetimepicker({timeFormat:e.data("time-format"),dateFormat:e.data("date-format")}):e.datepicker({showButtonPanel:!0,dateFormat:e.data("date-format")}))}),e.find(".fieldpress-select2").each(function(){h(w(this))||w(this).select2({width:"resolve"})}),e.find(".fieldpress-wysiwyg").each(function(){h(w(this))||r(w(this))}),0<w(".fieldpress-repeater").length&&l(),0<w(".fieldpress-sortable").length&&w(".fieldpress-sortable").each(function(){var e=w(this),t=e.find(".active-sortable"),i=e.find(".inactive-sortable");t.sortable({connectWith:i,placeholder:"ui-sortable-placeholder",update:function(e,t){var i=t.item,a=i.find("input");i.parent().hasClass("active-sortable")?a.attr("name",a.attr("name").replace("inactive","active")):a.attr("name",a.attr("name").replace("active","inactive"))}}),i.sortable({connectWith:t,placeholder:"ui-sortable-placeholder"})})},d=w(".fieldpress-addons");function v(e){return"checkbox"===e.attr("type")||"radio"===e.attr("type")?e.is(":checked"):e.val()}function g(e,s){d.find(".fieldpress-dependent."+e).each(function(){var e,t=w(this),i=t.data("condition"),a=t.data("conditional-value");if("=="==i)e=s==a;else if("!="==i)e=s!=a;else if(">="==i)e=Number(s)>=Number(a);else if("<="==i)e=Number(s)<=Number(a);else if(">"==i)e=Number(s)>Number(a);else if("<"==i)e=Number(s)<Number(a);else if("empty"==i)e=0===s.length;else{if("!empty"!=i)throw e=!1,new Error("Undefined condition: "+i);e=0!==s.length}e?t.removeClass("fieldpress-hidden"):t.addClass("fieldpress-hidden")})}d.find(".fieldpress-controller").each(function(){var e=w(this),t=v(e);g(e.attr("id"),t)}),i.on("load",function(){n(),p.on("widget-added widget-updated",function(e,t){c(t)}),w(function(){"widgets"===u.pagenow&&w(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){var e=w(this);c(e)})}),p.on("click",".fieldpress-actions .action",function(e){w(this).closest("form");s()}),p.on("click","#submitpost :submit",function(e){w(this).closest("form");s()}),p.on("click",".widget-control-actions .widget-control-save",function(e){w(this).closest("form");s()}),p.on("keyup change",".fieldpress-controller",function(e){var t=w(this),i=v(t);g(t.attr("id"),i)}),p.on("click","#fieldpress-reset",function(e){return 1==confirm(fieldpress.reset_confirm)||(e.preventDefault(),!1)})})}(jQuery,window,document);